# Nginx

* nginx下载源代码包

wget http://nginx.org/download/nginx-1.14.1.tar.gz

* 安装依赖
```
1. 安装Nginx需要用到pcre程序

wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.41.tar.gz

2. 安装epel扩展源

rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-lastest-7.noarch.rpm

3. yum clean all   yum list

4.安装依赖包

yum -y install gcc gcc-c++ autoconf automake zlib zlib-devel openssl openssl-devel pcre*

5.解压pcre
tar zxvf pcre-8.41.tar.gz -C /usr/local/src/

6. 创建Nginx运行用户
useradd -M -s /sbin/nologin nginx
```
* Nginx编译参数
```
./configure --prefix=/usr/local/nginx \
--with-http_dav_module --with-http_stub_status_module --with-http_addition_module \
--with-http_sub_module --with-http_flv_module --with-http_mp4_module \
--with-pcre=/usr/local/src/pcre-8.41 --user=nginx --group=nginx
```
* Nginx加入环境变量
```
1. vim /etc/profile

export PATH=/usr/local/nginx/sbin:$PATH

2. source /etc/profile  //刷新全局环境变量
```
* Nginx维护
```
1. 检查配置文件是否有语法错误

nginx -t

2. 查看Nginx版本和配置参数

nginx -V 

3. 优雅而平滑的关闭nginx

nginx -s quit

4. 强制关闭Nginx

nginx -s stop

5. 启动nginx

nginx

6. 重新加载配置文件

nginx -s reload

7. 重新开始记录日志文件

nginx -s reopen

```
* nginx的组成
```
1. Nginx 二进制可执行文件

   由各模块源码编译出的一个文件
  
2. Nginx.conf 配置文件

   控制 Nginx 的行为
  
3. access.log 访问日志
  
   记录每一条 http 请求信息
  
4. error.log 错误日志

   定位问题
```
* nginx的热部署（升级新版本的nginx）
```
1. 升级nginx的新版本，只是替换nginx的可执行的二进制文件nginx

2. 备份老的nginx,拷贝新的nginx可执行的二进制文件到相应的目录下

3. 给正在运行的nginx主进程USR2这个信号：   kill -USR2 nginx主进程号
   此时，老的worker进程就不再监听80端口了

4. kill -WINCH nginx主进程号，优雅的关闭老版本的nginx
```
* nginx的日志备份
```
1. 把当前的日志复制都要备份的文件夹

2. 重新生成新的日志
nginx -s reload

```
* Nginx主进程支持的信号
```
1. QUIT  优雅的关闭
kill -QUIT  Nginx的主进程号
nginx -s quit

2. HUP   重新加载配置文件
kill -HUP  Nginx的主进程号
nginx -s reload

3. USR1  重新打开日志
kill -USR1  Nginx的主进程号

4. USR2  平滑升级
kill -USR2  Nginx的主进程号  nginx的版本需要升级的时候，不需要停止nginx，就能对nginx升级

5. WINCH
kill -WINCH nginx主进程号   配合USR2对nginx升级，优雅的关闭nginx旧版本的进程
```
* nginx配置成静态的web服务器
```
```


